import argparse
import os
import json
from mcp.server.fastmcp import FastMCP

def open_cve_file(cve_id: str) -> str:

    (year, id) = cve_id.split('-')[1:]

    id_shard = int(int(id)/1000)
    cve_file = os.path.join('cvelistV5', 'cves', f"{year}", f"{id_shard}xxx", f"{cve_id}.json")
    with open(cve_file) as fh:
        json_data = json.load(fh)

    return json_data


mcp = FastMCP('cve-mcp')

@mcp.tool()
def get_cve(cve_id: str) -> dict:
    """Return the data for a given CVE ID

    Args:
        cve_id (str): The CVE ID
    
    Returns:
        A data structure of CVE ID data
    """

    cve_data = open_cve_file(cve_id)

    return cve_data

if __name__ == "__main__":
    print("Starting server")

    parser = argparse.ArgumentParser()
    parser.add_argument(
        "--server_type", type=str, default="sse", choices=["sse", "stdio"]
    )

    args = parser.parse_args()
    mcp.run(args.server_type)
